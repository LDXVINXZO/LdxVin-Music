<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Game Catur by LDXVIN — Classic Edition</title>
  <style>
    :root{
      --white:#f6f6f4;
      --black:#111111;
      --panel:#efefef;
      --muted:#666;
      --accent:#c99a5a; /* soft gold accent */
    }
    *{box-sizing:border-box;font-family:system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#f3f3f3,#e9e9e9);color:var(--black);-webkit-font-smoothing:antialiased}
    .app{max-width:920px;margin:10px auto;padding:12px;display:flex;flex-direction:column;gap:10px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{margin:0;font-size:18px}
    .subtitle{font-size:13px;color:var(--muted)}

    .menu{position:fixed;left:14px;top:14px;background:#fff;border:1px solid rgba(0,0,0,0.06);padding:10px;border-radius:8px;display:none;z-index:60;width:220px;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    .menu h4{margin:0 0 8px 0;font-size:13px;color:#333}
    .menu button{display:block;width:100%;padding:8px;border-radius:6px;border:0;background:transparent;color:var(--black);text-align:left;margin:6px 0;cursor:pointer;font-size:14px}

    .board-wrap{margin-top:10px;background:linear-gradient(180deg,#fff,#faf8f3);padding:14px;border-radius:10px;display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap;justify-content:center;box-shadow:0 6px 20px rgba(0,0,0,0.04)}
    .board{width:min(92vw,560px);height:min(92vw,560px);display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);border-radius:6px;overflow:hidden;border:2px solid rgba(0,0,0,0.06);touch-action:manipulation;background:linear-gradient(180deg,#fff,#f2efe8)}
    .square{display:flex;align-items:center;justify-content:center;font-size:calc(2.8vw + 8px);cursor:pointer;user-select:none;position:relative;transition:background .12s, transform .08s}
    .square.light{background:linear-gradient(180deg,var(--white),#fbfaf8);color:var(--black)}
    .square.dark{background:linear-gradient(180deg,#bfae8c,#a1885a);color:#fff} /* warm brown squares */
    .square.move::after{content:'';position:absolute;width:16%;height:16%;border-radius:50%;background:rgba(0,0,0,0.15)}
    .square.select{outline:3px solid rgba(201,154,90,0.18);transform:scale(1.02)}
    /* king in check subtle glow */
    .king-check{box-shadow:0 0 18px 6px rgba(201,154,90,0.12);animation:goldPulse 1s infinite alternate}
    @keyframes goldPulse{from{transform:translateZ(0)} to{transform:translateY(-2px) scale(1.01)}}

    .panel{width:260px;max-width:92vw;padding:12px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06)}
    .title{font-weight:700;margin-bottom:6px;color:var(--black)}
    .sub{font-size:13px;color:var(--muted);margin-bottom:10px}
    .btn{padding:9px 12px;border-radius:8px;border:0;background:linear-gradient(180deg,var(--accent),#c78a40);color:#fff;cursor:pointer;font-weight:700}
    .status{margin-top:10px;font-size:14px;color:var(--muted)}
    .scores{display:flex;gap:8px;margin-top:8px;align-items:center}
    .scorebox{flex:1;padding:8px;border-radius:6px;background:linear-gradient(180deg,#fff,#fbf7ee);text-align:center;border:1px solid rgba(0,0,0,0.03)}
    .scorebox strong{display:block;font-size:18px;color:var(--black)}

    .overlay{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:120;visibility:hidden;opacity:0;transition:opacity .18s,visibility .18s}
    .overlay.show{visibility:visible;opacity:1}
    .popup{padding:20px 24px;border-radius:10px;background:linear-gradient(180deg,#fff,#fcfbf8);border:1px solid rgba(0,0,0,0.06);text-align:center;box-shadow:0 18px 60px rgba(0,0,0,0.08)}
    .popup h2{margin:6px 0 4px 0;font-size:20px;color:var(--black)}
    .popup p{margin:0 0 10px 0;color:var(--muted)}

    @media (max-width:700px){
      .board{width:min(92vw,88vh);height:min(92vw,88vh)}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:10px">
        <div style="width:44px;height:44px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;cursor:pointer" id="hamburger">
          <div style="width:22px;height:2px;background:#333;box-shadow:0 6px 0 #333,0 -6px 0 #333"></div>
        </div>
        <div>
          <h1>Game Catur <small style="font-weight:700;color:var(--accent)">by LDXVIN</small></h1>
          <div class="subtitle">Classic Edition — Hitam & Putih dengan aksen emas</div>
        </div>
      </div>
      <div style="text-align:right">
        <div class="subtitle">Responsif untuk HP Android</div>
      </div>
    </div>

    <div class="menu" id="menu">
      <h4>Mode Permainan</h4>
      <button id="twoPlayerBtn">Main Berdua (2 pemain)</button>
      <button id="vsComputerBtn">Main bersama komputer</button>
      <div style="margin-top:6px;font-size:13px;color:#444">Mode sekarang: <strong id="modeLabel">Main Berdua</strong></div>
    </div>

    <div class="board-wrap">
      <div class="board" id="board" aria-label="Papan catur"></div>

      <div class="panel">
        <div class="title">Kontrol & Skor</div>
        <div class="sub">Klik bidak untuk memilih lalu klik tujuan. Sistem memeriksa sekak & skakmat. Komputer: langkah acak.</div>

        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="resetBtn">Reset Game</button>
          <button class="btn" id="clearScoreBtn" style="background:linear-gradient(180deg,#f0e2c7,#d9b66a);color:#111">Reset Skor</button>
        </div>

        <div class="status" id="status">Giliran: Putih</div>

        <div class="scores">
          <div class="scorebox">
            <div style="font-size:12px;color:var(--muted)">Skor Putih</div>
            <strong id="whiteScore">0</strong>
          </div>
          <div class="scorebox">
            <div style="font-size:12px;color:var(--muted)">Skor Hitam</div>
            <strong id="blackScore">0</strong>
          </div>
        </div>

        <div style="margin-top:10px;font-size:13px;color:var(--muted)">Tip: mode vs komputer — komputer jadi Hitam.</div>
      </div>
    </div>

    <div style="text-align:center;color:var(--muted);font-size:12px;margin-top:10px">Game catur by LDXVIN — Classic Edition</div>
  </div>

  <div class="overlay" id="overlay">
    <div class="popup" id="popup">
      <div style="background:linear-gradient(90deg,#f7efe3,#f2e9d4);padding:8px;border-radius:8px;display:inline-block;margin-bottom:8px;color:#5a3f15;font-weight:800" id="winBadge">Putih Menang!</div>
      <h2 id="winTitle">Skakmat</h2>
      <p id="winDesc">Selamat! Pemain memenangkan permainan.</p>
      <div style="margin-top:12px">
        <button class="btn" id="playAgainBtn">Main Lagi</button>
      </div>
    </div>
  </div>

  <script>
    // Classic edition JS (check/checkmate + simple AI + scores in localStorage)
    const PIECE_SYMBOLS = { r:'♖', n:'♘', b:'♗', q:'♕', k:'♔', p:'♙' };
    const BLACK_MAP = { r:'♜', n:'♞', b:'♝', q:'♛', k:'♚', p:'♟' };

    const initialFen = [
      ['r','n','b','q','k','b','n','r'],
      ['p','p','p','p','p','p','p','p'],
      ['','','','','','','',''],
      ['','','','','','','',''],
      ['','','','','','','',''],
      ['','','','','','','',''],
      ['P','P','P','P','P','P','P','P'],
      ['R','N','B','Q','K','B','N','R']
    ];

    let boardArr = [];
    let selected = null;
    let legalMoves = [];
    let turn = 'w';
    let mode = 'two';

    const SCORE_WHITE_KEY = 'ldxvin_classic_white';
    const SCORE_BLACK_KEY = 'ldxvin_classic_black';
    function getScore(k){ return parseInt(localStorage.getItem(k)||'0',10); }
    function setScore(k,v){ localStorage.setItem(k,String(v)); }

    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('status');
    const modeLabel = document.getElementById('modeLabel');
    const whiteScoreEl = document.getElementById('whiteScore');
    const blackScoreEl = document.getElementById('blackScore');

    // simple audio (click/check/mate) using WebAudio
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function tone(freq, dur=0.12){ try{ const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.value=freq; o.connect(g); g.connect(audioCtx.destination); g.gain.value=0; const now=audioCtx.currentTime; g.gain.linearRampToValueAtTime(0.09, now+0.01); o.start(now); g.gain.exponentialRampToValueAtTime(0.0001, now+dur); o.stop(now+dur+0.02); }catch(e){} }
    function playClick(){ tone(600,0.08); }
    function playCheck(){ tone(520,0.12); tone(720,0.09); }
    function playMate(){ tone(320,0.2); tone(480,0.22); }

    function resetBoard(){
      boardArr=[];
      for(let r=0;r<8;r++){ boardArr[r]=[]; for(let c=0;c<8;c++){ const ch=initialFen[r][c]; if(!ch) boardArr[r][c]=''; else { const color = ch===ch.toUpperCase() ? 'w':'b'; boardArr[r][c]={type:ch.toLowerCase(), color}; } } }
      selected=null; legalMoves=[]; turn='w'; render();
    }

    function render(){
      boardEl.innerHTML='';
      removeAllKingCheckHighlights();
      for(let r=0;r<8;r++){ for(let c=0;c<8;c++){
        const sq = document.createElement('div');
        sq.className = 'square ' + (((r+c)%2===0)?'light':'dark');
        sq.dataset.r = r; sq.dataset.c = c;
        const piece = boardArr[r][c];
        if(piece){ sq.textContent = piece.color==='w'?PIECE_SYMBOLS[piece.type]:BLACK_MAP[piece.type]; }
        if(selected && selected.r==r && selected.c==c) sq.classList.add('select');
        if(legalMoves.some(m=>m.r==r && m.c==c)) sq.classList.add('move');
        // king check highlight
        const kpW = findKing('w'); const kpB = findKing('b');
        if(kpW && kpW.r==r && kpW.c==c && isInCheck('w')) sq.classList.add('king-check');
        if(kpB && kpB.r==r && kpB.c==c && isInCheck('b')) sq.classList.add('king-check');
        sq.addEventListener('click', onSquareClick);
        boardEl.appendChild(sq);
      } }
      statusEl.textContent = 'Giliran: ' + (turn==='w'?'Putih':'Hitam');
      modeLabel.textContent = mode==='two'?'Main Berdua':'Main bersama komputer';
      whiteScoreEl.textContent = getScore(SCORE_WHITE_KEY);
      blackScoreEl.textContent = getScore(SCORE_BLACK_KEY);
    }

    function cloneBoard(b){ return b.map(row=>row.map(cell=> cell ? { type:cell.type, color:cell.color } : '')); }

    function generateRawMoves(r,c, boardState=null){
      const board = boardState || boardArr;
      const piece = board[r][c]; if(!piece) return []; const type=piece.type, color=piece.color; const moves=[]; const dir = color==='w'?-1:1;
      const onBoard = (rr,cc)=>rr>=0 && rr<8 && cc>=0 && cc<8;
      const pushIfEmptyOrEnemy = (rr,cc)=>{ if(!onBoard(rr,cc)) return; const t = board[rr][cc]; if(!t || t.color!==color) moves.push({r:rr,c:cc}); };
      if(type==='p'){ if(onBoard(r+dir,c)&&!board[r+dir][c]) moves.push({r:r+dir,c:c}); if((color==='w'&&r===6)||(color==='b'&&r===1)){ if(!board[r+dir][c]&&!board[r+2*dir][c]) moves.push({r:r+2*dir,c:c}); } [[r+dir,c-1],[r+dir,c+1]].forEach(([rr,cc])=>{ if(onBoard(rr,cc)&&board[rr][cc]&&board[rr][cc].color!==color) moves.push({r:rr,c:cc}); }); }
      else if(type==='n'){ [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>{ const rr=r+dr, cc=c+dc; if(onBoard(rr,cc)) pushIfEmptyOrEnemy(rr,cc); }); }
      else if(type==='b' || type==='r' || type==='q'){ const directions=[]; if(type==='b'||type==='q') directions.push([-1,-1],[-1,1],[1,-1],[1,1]); if(type==='r'||type==='q') directions.push([-1,0],[1,0],[0,-1],[0,1]); directions.forEach(([dr,dc])=>{ let rr=r+dr, cc=c+dc; while(onBoard(rr,cc)){ if(!board[rr][cc]) moves.push({r:rr,c:cc}); else{ if(board[rr][cc].color!==color) moves.push({r:rr,c:cc}); break; } rr+=dr; cc+=dc; } }); }
      else if(type==='k'){ for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){ if(dr===0&&dc===0) continue; const rr=r+dr, cc=c+dc; if(onBoard(rr,cc)) pushIfEmptyOrEnemy(rr,cc); } }
      return moves;
    }

    function findKing(color, boardState=null){
      const board = boardState || boardArr;
      for(let r=0;r<8;r++) for(let c=0;c<8;c++){ const p = board[r][c]; if(p && p.type==='k' && p.color===color) return {r,c}; }
      return null;
    }

    function isInCheck(color, boardState=null){
      const board = boardState || boardArr;
      const kingPos = findKing(color, board); if(!kingPos) return false;
      const enemy = color==='w' ? 'b':'w';
      for(let r=0;r<8;r++) for(let c=0;c<8;c++){ const p = board[r][c]; if(p && p.color===enemy){ const moves = generateRawMoves(r,c,board); if(moves.some(m=>m.r===kingPos.r && m.c===kingPos.c)) return true; } }
      return false;
    }

    function generateLegalMoves(r,c){
      const piece = boardArr[r][c]; if(!piece) return []; const raw = generateRawMoves(r,c); const legal=[];
      for(const m of raw){ const clone = cloneBoard(boardArr); clone[m.r][m.c] = clone[r][c]; clone[r][c] = ''; if(clone[m.r][m.c] && clone[m.r][m.c].type==='p'){ if(clone[m.r][m.c].color==='w' && m.r===0) clone[m.r][m.c].type='q'; if(clone[m.r][m.c].color==='b' && m.r===7) clone[m.r][m.c].type='q'; } if(!isInCheck(piece.color, clone)) legal.push(m); }
      return legal;
    }

    function allLegalMovesForColor(color){ const list=[]; for(let r=0;r<8;r++) for(let c=0;c<8;c++){ const p=boardArr[r][c]; if(p && p.color===color){ const moves = generateLegalMoves(r,c); moves.forEach(m=>list.push({from:{r,c},to:m})); } } return list; }

    function highlightKingCheck(color){ const pos = findKing(color); if(!pos) return; const squares = boardEl.querySelectorAll('.square'); for(const sq of squares){ if(parseInt(sq.dataset.r)===pos.r && parseInt(sq.dataset.c)===pos.c){ sq.classList.add('king-check'); } } }
    function removeAllKingCheckHighlights(){ const squares = boardEl.querySelectorAll('.square.king-check'); for(const s of squares) s.classList.remove('king-check'); }

    function makeMove(r1,c1,r2,c2){ const moving = boardArr[r1][c1]; boardArr[r2][c2] = moving; boardArr[r1][c1] = ''; if(moving && moving.type==='p'){ if(moving.color==='w' && r2===0) moving.type='q'; if(moving.color==='b' && r2===7) moving.type='q'; } turn = (turn==='w')?'b':'w'; }

    function onSquareClick(e){
      if(audioCtx.state==='suspended') audioCtx.resume().catch(()=>{});
      const r = parseInt(e.currentTarget.dataset.r); const c = parseInt(e.currentTarget.dataset.c); const cell = boardArr[r][c];
      if(cell && cell.color===turn){ selected={r,c}; legalMoves=generateLegalMoves(r,c); render(); playClick(); return; }
      if(legalMoves.some(m=>m.r==r && m.c==c)){ makeMove(selected.r,selected.c,r,c); selected=null; legalMoves=[]; render(); const opponent = (turn==='w')?'b':'w'; const opponentInCheck = isInCheck(opponent); if(opponentInCheck){ highlightKingCheck(opponent); playCheck(); statusEl.innerHTML = 'Giliran: ' + (turn==='w'?'Putih':'Hitam') + ' <small style=\"color:var(--muted)\"> (Sekak)</small>'; } const opponentLegal = allLegalMovesForColor(opponent); if(opponentInCheck && opponentLegal.length===0){ handleCheckmate(turn); return; } if(mode==='ai' && turn==='b'){ setTimeout(()=>computerMove(),380); } else { statusEl.textContent = 'Giliran: ' + (turn==='w'?'Putih':'Hitam'); } return; }
      selected=null; legalMoves=[]; render();
    }

    function postMoveChecks(){ const enemy = (turn==='w')?'b':'w'; if(isInCheck(turn)){ playCheck(); } const enemyMoves = allLegalMovesForColor(turn); const inCheck = isInCheck(turn); if(enemyMoves.length===0){ if(inCheck){ const winner = (turn==='w') ? 'b' : 'w'; handleCheckmate(winner); } else { handleStalemate(); } } }

    function computerMove(){ const moves = allLegalMovesForColor('b'); if(moves.length===0){ postMoveChecks(); return; } const captures = moves.filter(m=> boardArr[m.to.r][m.to.c] && boardArr[m.to.r][m.to.c].color==='w'); let pick; if(captures.length>0 && Math.random()<0.5) pick = captures[Math.floor(Math.random()*captures.length)]; else pick = moves[Math.floor(Math.random()*moves.length)]; makeMove(pick.from.r,pick.from.c,pick.to.r,pick.to.c); render(); postMoveChecks(); }

    function handleCheckmate(winnerColor){ if(winnerColor==='w'){ setScore(SCORE_WHITE_KEY, getScore(SCORE_WHITE_KEY)+1); } else { setScore(SCORE_BLACK_KEY, getScore(SCORE_BLACK_KEY)+1); } playMate(); document.getElementById('winBadge').textContent = (winnerColor==='w') ? 'Putih Menang!' : 'Hitam Menang!'; document.getElementById('winTitle').textContent = 'Skakmat'; document.getElementById('winDesc').textContent = 'Permainan selesai.'; const overlay=document.getElementById('overlay'); overlay.classList.add('show'); setTimeout(()=>{ overlay.classList.add('visible'); },10); render(); }

    function handleStalemate(){ document.getElementById('winBadge').textContent='Seri'; document.getElementById('winTitle').textContent='Pat (Stalemate)'; document.getElementById('winDesc').textContent='Permainan berakhir seri.'; document.getElementById('overlay').classList.add('show'); }

    // UI wiring
    document.getElementById('hamburger').addEventListener('click', ()=>{ const m=document.getElementById('menu'); m.style.display = m.style.display==='block' ? 'none' : 'block'; });
    document.getElementById('twoPlayerBtn').addEventListener('click', ()=>{ mode='two'; modeLabel.textContent='Main Berdua'; document.getElementById('menu').style.display='none'; resetBoard(); });
    document.getElementById('vsComputerBtn').addEventListener('click', ()=>{ mode='ai'; modeLabel.textContent='Main bersama komputer'; document.getElementById('menu').style.display='none'; resetBoard(); });
    document.getElementById('resetBtn').addEventListener('click', ()=>{ resetBoard(); removeAllKingCheckHighlights(); });
    document.getElementById('clearScoreBtn').addEventListener('click', ()=>{ if(confirm('Reset skor Putih & Hitam?')){ setScore(SCORE_WHITE_KEY,0); setScore(SCORE_BLACK_KEY,0); render(); } });
    document.getElementById('playAgainBtn').addEventListener('click', ()=>{ document.getElementById('overlay').classList.remove('show'); resetBoard(); });

    // ensure score keys exist
    if(localStorage.getItem(SCORE_WHITE_KEY)===null) setScore(SCORE_WHITE_KEY,0);
    if(localStorage.getItem(SCORE_BLACK_KEY)===null) setScore(SCORE_BLACK_KEY,0);

    // initial load
    resetBoard();
  </script>
</body>
</html>
